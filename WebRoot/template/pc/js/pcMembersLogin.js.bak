function checkAuto(){var e=$("#loginName").val(),o=$("#loginPwd").val(),t=$("#autoLogin").attr("checked"),i=new Date;i.setDate(i.getDate()+30),"checked"==t&&(TuYou.Cookie.set("loginName",e,i),TuYou.Cookie.set("loginPwd",o,i))}function autoLogin(){var e=TuYou.Cookie.get("loginName"),o=TuYou.Cookie.get("loginPwd");JM.isNull(e)||JM.isNull(o)||($("#loginName").val(e),$("#loginPwd").val(o))}function login(){var e=$("#loginName").val(),o=$("#loginPwd").val(),t=$("#linkIndex").attr("href"),i=$("#lastUrl").val();$.ajax({url:"pcBjdjMember_login.action",type:"post",data:{loginName:e,loginPwd:o},dataType:"json",success:function(e){"y"==e.status?JM.alert("登录成功",2e3,function(){checkAuto(),i?JM.goUrl(i):JM.goUrl(t)}):alert(e.info)},error:function(){alert("服务器出错了")}})}function checkPhone(){var e=$("#mobileForm").Validform().check(!1,"#mobile");return!!e}function sendAuthcodeLogin(){var e=$("#getCaptchaLogin"),o=$("#mobileLogin").val();checkPhone()&&$.ajax({url:"pcBjdjMember_generateAuthCode.action",type:"post",dataType:"json",data:{phone:o},success:function(o){if("y"==o.status)var t=e.val(),i=60,n=setInterval(function(){i>0?(e.show(),$("#yzm").hide(),e.attr("disabled","disabled"),e.text(--i+"秒后重新获取...")):(e.hide(),$("#yzm").show(),e.removeAttr("disabled"),e.val(t),clearInterval(n))},1e3);else JM.alert(o.info,2e3)}})}function mobileLogin(){var e=$("#mobileLogin").val(),o=$("#authcode").val(),t=$("#linkIndex").attr("href"),i=$("#lastUrl1").val();$.ajax({url:"pcBjdjMember_checkAuthForMobile.action",type:"post",dataType:"json",data:{phone:e,authCode:o},success:function(e){"y"==e.status?JM.alert("登录成功",2e3,function(){i?JM.goUrl(i):JM.goUrl(t)}):alert(e.info)},error:function(){alert("服务器出错了")}})}$(function(){$("#memberForm").Validform({btnSubmit:"#login",ajaxPost:!0,tiptype:function(e,o,t){if(o.obj.is("form")){var i=o.obj.find("#msgdemo");t(i,o.type),i.text(e)}else{var i=o.obj.siblings(".Validform_checktip");t(i,o.type),i.text(e)}},beforeSubmit:function(e){return login(),!1}}),$("#yzm").click(sendAuthcodeLogin),$("#mobileForm").Validform({btnSubmit:"#login",tiptype:function(e,o,t){if(o.obj.is("form")){var i=o.obj.find("#msgdemo");t(i,o.type),i.text(e)}else{var i=o.obj.siblings(".Validform_checktip");t(i,o.type),i.text(e)}},ajaxPost:!0,beforeSubmit:function(e){return mobileLogin(),!1}}),autoLogin()});