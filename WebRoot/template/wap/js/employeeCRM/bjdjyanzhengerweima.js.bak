function printHtml(e){$(window.document.body).append(e+"<br/>")}function startPat(){context.drawImage(video,0,0,canvas.width=video.videoWidth,canvas.height=video.videoHeight),CatchCode()}function CatchCode(){if(null!=canvas){var e=canvas.toDataURL(),t=e.substr(22);$.post("wapValidation_erWeiMa.action",{img64:t},function(e){"y"==e.status?JM.goUrl("wapValidation_erWeiMaSuccess1.action?serviceCode="+e.info):setTimeout(function(){startPat()},200)},"json")}}function getVideoInfo(){var e=$("video"),t=e[0].videoHeight,i=e[0].videoWidth;console.log("Height: "+e[0].videoHeight+", Width: "+e[0].videoWidth),console.log("Height: "+t+", Width: "+i);var o=t/i;console.log(o),window.onresize=function(){e.height()/e.width()>o?console.log("Width:"+e.width()+" Height: "+e.width()*o):console.log("Width:"+e.height()/o+" Height: "+e.height())}}var canvas=null,context=null,video=null;window.addEventListener("DOMContentLoaded",function(){"use strict";try{canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),video=document.getElementById("video");var e={video:!0,audio:!1},t=!0,i=function(e){t=!1,e.PERMISSION_DENIED?alert("用户拒绝了浏览器请求媒体的权限","提示"):e.NOT_SUPPORTED_ERROR?alert("对不起，您的浏览器不支持拍照功能，请使用其他浏览器","提示"):e.MANDATORY_UNSATISFIED_ERROR?alert("指定的媒体类型未接收到媒体流","提示"):alert("系统未能获取到摄像头，请确保摄像头已正确安装。或尝试刷新页面，重试","提示")};if(navigator.getUserMedia){if(navigator.userAgent.indexOf("MQQBrowser")>-1)return alert("对不起，您的浏览器不支持拍照功能，请使用其他浏览器","提示"),!1;navigator.getUserMedia(e,function(e){video.src=e,video.play()},i)}else if(navigator.webkitGetUserMedia)navigator.webkitGetUserMedia(e,function(e){video.src=window.webkitURL.createObjectURL(e),video.play()},i);else if(navigator.mozGetUserMedia)navigator.mozGetUserMedia(e,function(e){video.src=window.URL.createObjectURL(e),video.play()},i);else{if(!navigator.msGetUserMedia)return alert("对不起，您的浏览器不支持拍照功能，请使用其他浏览器"),!1;navigator.msGetUserMedia(e,function(e){$(document).scrollTop($(window).height()),video.src=window.URL.createObjectURL(e),video.play()},i)}$("#snap").click(function(){startPat()}).show()}catch(e){JM.alert("浏览器不支持HTML5 CANVAS",2e3)}},!1);