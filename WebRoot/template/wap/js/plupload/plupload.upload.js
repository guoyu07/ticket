function showImg(){$("#showImg").show();var e=$(this),i=e.parent().data("img");$("#showImg").attr("src",i),setTimeout(function(){easyDialog.open({container:"easyDialogWrapper1",callback:function(){$("#showImg").hide()}})},2e3)}$(function(){function e(e,i){if(e&&/image\//.test(e.type))if("image/gif"==e.type){var t=new mOxie.FileReader;t.onload=function(){i(t.result),t.destroy(),t=null},t.readAsDataURL(e.getSource())}else{var n=new mOxie.Image;n.onload=function(){n.downsize(300,300);var e="image/jpeg"==n.type?n.getAsDataURL("image/jpeg",80):n.getAsDataURL();i&&i(e),n.destroy(),n=null},n.load(e.getSource())}}$("#browse").click(function(){i.refresh()});var i=new plupload.Uploader({browse_button:"browse",url:"file_loadAndShow.action",flash_swf_url:"/template/js/plupload/Moxie.swf",silverlight_xap_url:"/template/js/plupload/Moxie.xap",max_file_size:"100mb",filters:{mime_types:[{title:"图片文件",extensions:"jpg,png,bmp"}],prevent_duplicates:!0}});i.init(),i.bind("FilesAdded",function(i,t){for(var n=0,o=t.length;n<o;n++){var a=t[n].name,l='<li id="file-'+t[n].id+'"><p class="file-name">'+a+'</p><button id="btn'+t[n].id+'" data-val="'+t[n].id+'">移除</button><p class="progress"></p></li>';$(l).appendTo("#file-list"),!function(i){e(t[i],function(e){$("#file-"+t[i].id).append('<img src="'+e+'" id="img'+t[i].id+'"/>')})}(n),$("#btn"+t[n].id).click(function(){var e=$(this),t=e.parent();t.remove();var n="",o=$(this).attr("data-val");for(var a in i.files)i.files[a].id===o&&(n=a);i.files.splice(n,1)})}}),i.bind("UploadProgress",function(e,i){$("#file-"+i.id+" .progress").css("width",i.percent+"%")}),$("#upload").click(function(){i.start()}),i.bind("FileUploaded",function(e,i,t){var n=t.response;$("#scenePhoto").val(n)}),i.bind("UploadComplete",function(e,i){if(0==i.length)easyDialog.open({container:{content:"请至少选择一张图片"},autoClose:2e3});else{for(var t=0,n=i.length;t<n;t++)$("#img"+i[t].id).click(showImg);var o="上传完毕！此次上传"+i.length+"幅图片!";easyDialog.open({container:{content:o},autoClose:2e3})}}),i.bind("Error",function(e,i){var t=i.message;easyDialog.open({container:{content:t},autoClose:3e3})})});